
# Triggers

*Purpose: show the use of "triggers" to do some action when something else occurs*

 A trigger is a stored procedure in database which automatically invokes whenever a special event in the database occurs. For example, a trigger can be invoked when a row is inserted into a specified table or when certain table columns are being updated.

Detail: Create trigger can't be used with SELECT(only INSERT, UPDATE, DELETE, CREATE, ALTER, DROP)

References:
- https://www.geeksforgeeks.org/sql-trigger-student-database/
- https://docs.microsoft.com/en-us/sql/t-sql/statements/create-trigger-transact-sql?view=sql-server-ver15
- https://www.sqlservertutorial.net/sql-server-triggers/sql-server-create-trigger/
- https://docs.microsoft.com/en-us/sql/t-sql/statements/create-trigger-transact-sql?view=sql-server-ver15

Create a new database

	use master
	exec Happybits.Recreate 'Demo'
	go
	use Demo

# Exercise: setup database

Create these tables:

	Employee
	- Name
	- Salary (number)
	- Role   (string)

	Log
	- Text (string)
	- Date (datetime)

# Exercise: add one row

Insert one row in the log tables with the text 'Some message' and the date 2020-01-01.

# Exercise: add one row with current date

Try this command

	select GETDATE()

Add one more row in the Log-table with the current date (generated by GETDATE)

# Exercise: add a trigger

Create a trigger: after someone insert a value to the Employee-table => Add a row to the table "Log"

Hint, use this pattern:

	CREATE TRIGGER ...
	ON ...
	AFTER ...
	AS ....

# Exercise: test and veriy the trigger

Test the trigger

	insert into Employees values('Arne', 10000, 'Software')
	insert into Employees values('Berit', 20000, 'Software')

## Exercise: get info of inserted rows (hard)

SQL Server provides two virtual tables that are available specifically for triggers called INSERTED and DELETED tables. SQL Server uses these tables to capture the data of the modified row before and after the event occurs.

Create a trigger that will add the name of the inserted Employee

Expected result if you add two customers names Arne and Bertil.

	Employee "Arne" inserted	2021-12-01 10:21:10.163
	Employee "Berit" inserted	2021-12-01 10:21:10.163
